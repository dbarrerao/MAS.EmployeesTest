@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@model MAS.Models.ViewModel.ViewModelEmployee;

<div class="container py-5">
    <div class="row">
        <div class="col-md-11 mx-auto">
            <div class="form-group row">
                <br>
                <h1 style="text-align:center; color:cadetblue"><srtong>Employees</srtong></h1>
                <br>
                <br>
                <div class="col-sm-6">
                    <input placeholder="Employee ID" id="txtEmployeeId" class="form-control mr-sm-2">
                </div>
                <div class="col-sm-6">
                    <button id="btnSearch" type="button" class="btn backgroundControl my-2 my-sm-0">Get Employees</button>
                </div>
            </div>
        </div>
    </div>     
    <div class="row" id="idTable">
        <div class="col-md-10 mx-auto">
            <div class="form-group row">
                <div class="col-sm-12">
                    <table class="table table-striped" id="Table" data-paging="true" data-paging-count-format="{CP} de {TP}" data-paging-size="5">
                        <tr>
                            <th class="backgroundControl text-center">ID</th>
                            <th class="backgroundControl text-center">Name</th>
                            <th class="backgroundControl text-center">Contract Type</th>
                            <th class="backgroundControl text-center">Role ID</th>
                            <th class="backgroundControl text-center">Role Name</th>
                            <th class="backgroundControl text-center">Role Description</th>
                            <th class="backgroundControl text-center">Hourly Salary</th>
                            <th class="backgroundControl text-center">Monthly Salary</th>
                            <th class="backgroundControl text-center">Annual Salary</th>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div> 
</div>
<script type="text/javascript">

    $(document).ready(function () {   

        $('#idTable').hide();

        $("#btnSearch").on("click", function () {
            var employeeId = $("#txtEmployeeId").val();
            employeeId = Number(employeeId);

            $("body").loading('start');
            if (employeeId == "")
            {
                GetAllEmployees();                
            } else
            {
                GetEmployeeById(employeeId);                 
            }            
        });
    });

    /// Function that return the information of all employees and display it in a table.
    function GetAllEmployees() { 
        $.ajax({
            type: "GET",
            url: "/api/Employee",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (data) {
                $("#idTable").find("tr:gt(0)").remove();
                if (data != null) {
                    $('#idTable').show();
                    $.each(data, function (i, item) {
                        displayInformation(item)
                    });
                }
                else {
                    MessageConfirmation("Register not found.");
                }
            },
            complete: function (xhr, status) {
                $("body").loading('stop');
            }
        });
    }

    /// Function that return the information of one employee and display it in a table.
    function GetEmployeeById(employeeId) {       
        $.ajax({
            type: "GET",
            url: "/api/Employee/" + employeeId,
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (data) {               
                $("#idTable").find("tr:gt(0)").remove();
                if (data != null) {
                    $('#idTable').show();                  
                    displayInformation(data)
                }
                else
                {
                    MessageConfirmation("Register not found.");
                }
            },
            complete: function (xhr, status) {
               $("body").loading('stop');
            }
        });
    }

    function displayInformation(data)
    {        
        var rows =
            "<tr>" +
            "<td id='Name'>" + data.id + "</td>" +
            "<td id='Name'>" + data.name + "</td>" +
            "<td id='ContractTypeName'>" + data.contractTypeName + "</td>" + 
            "<td id='RoleId'>" + data.roleId + "</td>" +
            "<td id='RoleName'>" + data.roleName + "</td>" + 
            "<td id='RoleDescription'>" + data.roleDescription + "</td>" +
            "<td id='HourlySalary'>" + data.hourlySalary + "</td>" + 
            "<td id='MonthlySalary'>" + data.monthlySalary + "</td>" +
            "<td id='AnnualSalary'>" + data.annualSalary + "</td>" + 
            "</tr>";                    
        $('#Table').append(rows); 
    }


    function MessageConfirmation(message)
    {      
      $('#idTable').hide();
      alert(message);
    }
</script>